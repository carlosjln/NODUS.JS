(function(n,t){function r(){}function i(n){var o;if(n instanceof i)return n;if(typeof n=="string")return new i({id:n});var r=this,t=n.id,f=e[t];return f?f:(o=u[t],o)?(console.log("Node{ id="+t+"} was requested, but not registered on the node collection."),null):r instanceof i?(r.id=t,u[t]={data:!1,handlers:!1},e[t]=r,p(t,n),this):null}function p(n,t){var r=e[n]||new i(n);r.name=t.name;r.caption=t.caption;r.parent_id=t.parent_id;k[n]=t;g(r,t.handlers);nt(r,t.actions)}function g(t,i){if(i===null||i==="")return null;var r={},u={node:t,handlers:r,shared:d};try{new Function("context","window",i)(u,n)}catch(f){throw f;}h[t.id]=r}function nt(n,t){var f,r;for(t=t||[],f=n.id,r=t.length;r--;){var e=t[r],i=e.id,s=e.name,u=function(n){return function(t){o({action_id:n,data:t})}}(i),h={id:i,name:s,node_id:f,method:u};u.id=i;n[s]=u;v[i]=h}}function l(n,t){var i,r,f;if(n===null)return null;if(i=n.id,r=c[i],r)return t.call(r);if(f=function(){l(n,t)},u[i].data===!1)return it(n,f);if(u[i].handlers===!1)return rt(n,f);c[i]=n;t.call(n)}function tt(n,t){var r=n.id,e=h[r],i=e.view||{is_empty:!0},u=i.exception||e.exception||f,o,v,p,w,c,l;if(i.is_empty)return o=new a("The Node ["+n.name+"] does not have a view handler."),u.call(e,o);v=i.before_request||function(){return!0};p=i.on_request||function(){};try{w=v.call(i,t)}catch(o){return u.call(i,o)}if(w){if(c=ut(r,i,t,u),p.call(i),l=y[r],l)return c(l);s({url:r+"/view/",on_success:c,on_error:u})}}function o(n){var p=n.action_id,g,ot;if(p===null)return null;var i=v[p],w=i.name,nt=i.node_id,tt=e[nt];if(c[i.node_id]===null)return l(tt,function(){o(n)});var b=n.query||"",u=n.data||{},k=h[i.node_id],t=k.actions[w];if(t===null)throw new Error("The action '"+w+"' is not defined on the handler.");var it=t.before_request||function(){return!0},rt=t.get_params||function(){return""},ut=t.on_request||function(){},ft=t.on_success||function(){throw new Error("The method 'Handle.action."+w+".on_success' is undefined.");},y=t.exception||k.actions.exception||k.exception||f,d;try{d=it.call(t,u)}catch(et){return y.call(t,et)}d&&(g=function(n){var i=r.parse_reply(n);if(i.has_errors())return y.call(t,i.exceptions);try{ft.call(t,i,u)}catch(f){y(new a(f))}},b=b||rt.call(t,u),ot="query="+encodeURIComponent(r.encode_base64(b)),ut.call(t,u),s({url:"action/"+p,on_success:g,on_error:y}))}function it(n,t){var e=n.id;u[e].data=!0;s({url:e,on_success:function(n,u){var e=r.parse_reply(n);return e.has_errors()?f(e.exceptions):(i.update(u,e.data),t())},parameters:[e]})}function rt(n,t){var e=n.id;u[e].handlers=!0;s({url:e+"/handlers",on_success:function(n,u){var e=r.parse_reply(n);return e.has_errors()?f(e.exceptions):(i.update(u,e.data),t())},parameters:[e]})}function ut(n,i,u,f){var e=i.on_success||function(){throw new Error("Handle.view.on_success is undefined.");};return function(o){var h=r.parse_reply(o),s,c;if(h.has_errors())return f(h.exceptions);s=h.data;c="view_"+n;s.cache&&(y[n]=s);t.getElementById(c)===null&&(r.create_style(s.style).id=c);try{e.call(i,s,u)}catch(l){f.call(i,new a(l))}}}function s(n){n.url="node/"+n.url;n.on_error=n.on_error||f;r.request(n)}function f(n){console.log("ApplicationException: ",n)}function a(n){n=typeof n=="string"?{message:n}:n;this.validation=[];this.application=[{name:"ApplicationException",message:n?n.message:""}]}function w(n){var r=n.target||n.srcElement||t,u=b(r,"node-id"),f=b(r,"action-id");(u||f)&&(n.preventDefault(),r.blur());u?new i(u).view():f&&o({action_id:f})}function b(n,t){var i=n.getAttribute(t),r;return i===undefined&&(r=n.parentNode)&&(i=r.getAttribute(t)),i}var e={},k={},v={},h={},u={},d={},y={},c={};i.prototype={view:function(n){var t=this,i=function(){tt(t,n)};return l(t,i),t},exec:function(n){var i=this[n],f;if(i){var r=Array.prototype.slice.call(arguments),t=r[1],u=r[2];t&&typeof t=="object"&&(u=t,t=null);f={action_id:i.id,query:t,data:u};o(f)}}};i.update=function(n,t){p(n,t)};r.Node=i;t.addEventListener?t.addEventListener("click",w,!1):t.attachEvent("onclick",w);n.NODUS=r;n.Node=i})(window,document),function(n,t,i){function s(n){var t={},i=n.slice(0);return e(t,i),t}function e(n,t){for(var u=n.id,r=t.length,i;r--;)i=new Node(t[r]),i.parent_id===u&&(n[i.name]=i,e(i,t))}function h(n){var t=n.exceptions;return t.validation=f(t,function(n){return n.type==="Validation"}),t.application=f(t,function(n){return n.type==="Application"}),t.system=f(t,function(n){return n.type==="System"}),n.has_errors=function(){return this.exceptions.length>0},n}function u(n,t){var s=r(n),i,e,f,o;switch(s){case"object":i=t||{};for(e in n)n.hasOwnProperty(e)&&(i[e]=u(n[e]));break;case"array":for(i=t||[],f=0,o=n.length;f<o;f++)i[f]=u(n[f]);break;case"date":i=new Date;i.setTime(n.getTime());break;default:i=n}return i}function l(){for(var t=arguments,r=t.length,i={},n=0;n<r;n++)u(t[n],i);return i}function v(n){for(var t=a,i=o(n),y=i.length,r=0,s="",h,u,f,l,v,c,e;r<y;)h=i.charCodeAt(r++),u=i.charCodeAt(r++),f=i.charCodeAt(r++),l=h>>2,v=(h&3)<<4|u>>4,c=(u&15)<<2|f>>6,e=f&63,isNaN(u)?c=e=64:isNaN(f)&&(e=64),s=s+t.charAt(l)+t.charAt(v)+t.charAt(c)+t.charAt(e);return s}function o(n){for(var r=n.replace(/\r\n/g,"\n"),u=r.length,f=0,i="",t;u--;)t=r.charCodeAt(f++),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i}function f(n,t){for(var f=n.length,i=0,r=[],u;i<f;i++)u=n[i],t(u)&&(r[r.length]=u);return r}var r=function(){function i(i){var r=typeof i;return i===null?"null":r==="object"||r==="function"?n[t.call(i)]||"object":r}var n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object","[object Error]":"error"},t=n.toString;return i}(),c=function(n){function t(n){var u,f,o,s,e;if(this instanceof t==!1)return new t(n);u=this;f=u.transport=i();for(e in n)o=r(u[e]),s=n[e],n.hasOwnProperty(e)&&(o==="undefined"||o===r(s))&&(u[e]=s);var h=u.method;f.open(h,u.url,!0);f.onreadystatechange=function(){u.on_ready_state_change.call(u)};h=="POST"&&f.setRequestHeader("Content-type","application/x-www-form-urlencoded");f.send(u.send)}var i=n.XMLHttpRequest?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return t.prototype={url:"",method:"GET",on_complete:function(){},on_success:function(){},on_error:function(){},on_ready_state_change:function(){var n=this.transport,r=n.readyState,t,i;if(r!==4)return null;try{t=n.status}catch(u){return null}if(t!==200)return null;i=n.responseText;console.log(i)},get_error:function(){}},t}(t),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.build_node_tree=s;n.parse_reply=h;n.merge=l;n.encode_base64=v;n.encode_utf8=o;n.request=c}(NODUS,window,document);